<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schimpfolinos Hirnprogrammierer V1.1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
        	padding: 0;
            height: 100%;
        	color: #000;
        }
        .top {
            background-color: #00c7c7;
            height: 30px;
            padding: 10px;
            display: block;
        }
        .mitte {
            position: absolute;
            width: 100%;
        	top: 50px;
            bottom: 40px;
            overflow: auto;
            text-align: center;
	    }
        .links_rahmen {
            direction: rtl;
        }
        .links {
            direction: ltr; 
            margin: 10px;
            margin-top: 0px;
            width: 45%;
            height: 100%;
            float: left;
            text-align: justify;
        }
        .rechts-container {
            margin: 10px;
            margin-top: 0px;
            width: 45%;
            height: 100%;
            float: right;
            border-left: 1px solid #000;
            display: flex;
            flex-direction: row;
            gap: 2px;
        }
        .rechts {
            flex: 1;
            text-align: center;
            border-right: 1px solid #ccc;
            overflow-y: auto;
            padding: 5px;
            min-width: 0;
        }
        .rechts:last-child {
            border-right: none;
        }
        .unten {
            position: absolute;
            width: 100%;
            font-size: 14px;
            bottom: 0px;
            background-color: #00c7c7;
            height: 30px;
            padding: 10px;
        }
        .container {
            margin-bottom: 20px;
        }
        .textfield {
            margin-bottom: 5px;
        }
        .textfield input {
            width: 90%;
            max-width: 80px;
            font-size: 12px;
        }
        h2 {
            color: #000;
            margin: 5px 0;
        }
        h3 {
            text-align: center;
            font-size: 14px;
            margin: 5px 0;
        }
        .load-button {
            margin-bottom: 10px;
            padding: 5px 10px;
            font-size: 11px;
            width: 90%;
        }
        .word-counter {
            font-size: 11px;
            margin-bottom: 10px;
            color: #666;
        }
        .button {
	        color: #000;
        	border: 2px solid #d04040;
        	background-color: #fff;
        }
        .button:hover {
            background-color: #d0d0d0;
        }
        input[type=file]::file-selector-button {
            color: #000;
            border: 2px solid #d04040;
            background-color: #fff;
        }
        input[type=file]::file-selector-button:hover {
            background-color: #d0d0d0;
        }
        /* Für mobile Geräte */
        @media (max-width: 600px) {
            .rechts-container {
                position: relative;
                top: 0;
                float: none;
                margin-top: 0;
                width: 100%;
                flex-direction: column;
                height: auto;
            }
            .rechts {
                border-right: none;
                border-bottom: 1px solid #ccc;
            }
            .rechts:last-child {
                border-bottom: none;
            }
            .links {
                float: none;
                width: 100%;
            }
        }
    </style>
    <script>
        var elements = [0, 0, 0, 0, 0];
        var currentContainer = 0;
        
        function loadFileForContainer(containerIndex){
            // Erstelle ein temporäres file input element
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.txt';
            fileInput.style.display = 'none';
            
            fileInput.onchange = function(event) {
                const fileToLoad = event.target.files[0];
                if (!fileToLoad) return;
                
                const fileReader = new FileReader();
                
                // Update header mit Dateiname
                document.getElementById(`opened${containerIndex + 1}`).innerHTML = fileToLoad.name;
                document.getElementById('filename').selectedIndex = containerIndex;
                
                // Container leeren
                clearContainer(containerIndex);
                
                fileReader.onload = function(fileLoadedEvent) {
                    const textLoaded = fileLoadedEvent.target.result;
                    let buffer = '';
                    let counter = 0;
                    for (let i = 0; i < textLoaded.length; i ++ ) {
                        switch (textLoaded.charAt(i)) {
                            case '[': buffer += 'ä'; break;
                            case ']': buffer += 'ö'; break;
                            case '^': buffer += 'ü'; break;
                            case '_': buffer += 'ß'; break;
                            case '{': buffer += 'Ä'; break;         
                            case '|': buffer += 'Ö'; break;
                            case '}': buffer += 'Ü'; break;
                            default: buffer += textLoaded.charAt(i);  
                        } 
                        counter ++;                 
                        if (counter == 10) {
                            addTextField(buffer, containerIndex);
                            buffer = '';
                            counter = 0;
                        }
                    }
                }
                fileReader.readAsText(fileToLoad, "UTF-8");
                
                // Entferne das temporäre input element
                document.body.removeChild(fileInput);
            };
            
            // Füge das input element hinzu und trigger den click
            document.body.appendChild(fileInput);
            fileInput.click();
        }
        
        function loadFileAsText(){
            const fileToLoad = document.getElementById("fileToLoad").files[0];
            const fileReader = new FileReader();
            var name = document.getElementById('fileToLoad'); 
            
            // Bestimme welcher Container basierend auf Dateiname
            const filename = name.files.item(0).name;
            let containerIndex = 0;
            if (filename.includes('eeprom1')) containerIndex = 0;
            else if (filename.includes('eeprom2')) containerIndex = 1;
            else if (filename.includes('eeprom3')) containerIndex = 2;
            else if (filename.includes('eeprom4')) containerIndex = 3;
            else if (filename.includes('eeprom5')) containerIndex = 4;
            
            currentContainer = containerIndex;
            document.getElementById(`opened${containerIndex + 1}`).innerHTML = filename;
            document.getElementById('filename').selectedIndex = containerIndex;
            
            // Container leeren
            clearContainer(containerIndex);
            
            fileReader.onload = function(fileLoadedEvent) {
                const textLoaded = fileLoadedEvent.target.result;
                let buffer = '';
                let counter = 0;
                for (let i = 0; i < textLoaded.length; i ++ ) {
                    switch (textLoaded.charAt(i)) {
                        case '[': buffer += 'ä'; break;
                        case ']': buffer += 'ö'; break;
                        case '^': buffer += 'ü'; break;
                        case '_': buffer += 'ß'; break;
                        case '{': buffer += 'Ä'; break;         
                        case '|': buffer += 'Ö'; break;
                        case '}': buffer += 'Ü'; break;
                        default: buffer += textLoaded.charAt(i);  
                    } 
                    counter ++;                 
                    if (counter == 10) {
                        addTextField(buffer, containerIndex);
                        buffer = '';
                        counter = 0;
                    }
                }
            }
            fileReader.readAsText(fileToLoad, "UTF-8");
        }
        
        function clearContainer(containerIndex) {
            const container = document.getElementById(`container${containerIndex + 1}`);
            const textfields = container.getElementsByClassName('textfield');
            while(textfields.length > 0) {
                textfields[0].remove();
            }
            elements[containerIndex] = 0;
            updateWordCount();
        }
        
        function addTextField(entry, containerIndex = null) {
            if (containerIndex === null) {
                containerIndex = document.getElementById('filename').selectedIndex;
            }
            
            elements[containerIndex]++;
            updateWordCount();
            
            const container = document.getElementById(`container${containerIndex + 1}`);
            const div = document.createElement('div');
            div.className = 'textfield';
            const input = document.createElement('input');
            input.type = 'text';
            input.maxLength = 10;
            input.value = entry || '';
            div.append(input);
            container.append(div);
            container.scrollTop = container.scrollHeight;
        }
        
        function updateWordCount() {
            // Update individual counters
            for (let i = 0; i < 5; i++) {
                document.getElementById(`words${i + 1}`).innerHTML = elements[i];
            }
            
            // Update total counter
            const total = elements.reduce((a, b) => a + b, 0);
            document.getElementById('words').innerHTML = total;
        }
        
        function saveTextFields() {
            const containerIndex = document.getElementById('filename').selectedIndex;
            const container = document.getElementById(`container${containerIndex + 1}`);
            const inputs = container.getElementsByTagName('input');
            let content = '';
            
            for (let input of inputs) {
                let length = input.value.length;
                let text = input.value;
                for (let i = 0; i < length; i ++) {
                    text = text.replace('ä', '[');
                    text = text.replace('ö', ']');
                    text = text.replace('ü', '^');
                    text = text.replace('ß', '*');
                    text = text.replace('Ä', '{');
                    text = text.replace('Ö', '|');
                    text = text.replace('Ü', '}');
                }
                if (length < 10) 
                    for (let  i = 0; i < (10 - length); i ++) {               
                        text += ' ';
                    }
                if (text !='          ') content += text;
            }
            content += '!';
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = document.getElementById('filename').value;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function selectContainer(index) {
            document.getElementById('filename').selectedIndex = index;
        }
    </script>
</head>
<body>
    <div class="top">    
        <h2>Schimpfolinos Hirnprogrammierer V1.1</h2>
    </div>
    <div class="mitte">
        <h1>Schimpfolinos Hirnprogrammierer</h1>
        <div class="links">
            <h3>Anleitung</h3>
            <b>&quot;Mickriger Luscheniltis&quot;</b><br />
            <br />
            Dieses stilvolle Schimpfolino-Beispiel setzt sich aus <b>drei</b> Komponenten zusammen:<br />
            <ol>
                <li>Ein Adjektiv &quot;Mickriger&quot;</li>
                <li>Ein Wortteil &quot;Luschen&quot;-</li>
                <li>Ein Substantiv -&quot;iltis&quot; (m&auml;nnlich).</li>
            </ol>
            Das Adjektiv muss im Femininum, also &quot;Mickrige&quot; geschrieben werden. &quot;r&quot; bei Maskulinum
            und &quot;s&quot; bei Neutrum werden von Schimpfolino automatisch ergänzt. Das Substantiv muss klein 
            geschrieben werden.<br />
            <br />
            Diese Komponenten werden zu je <b>zehn</b> Zeichen in <b>f&uuml;nf</b> Dateien gespeichert:<br />
            <ol>
                <li><b>eeprom1.txt</b>: Adjektiv</li>
                <li><b>eeprom2.txt</b>: Erster Teil des zweiten Wortes</li>
                <li><b>eeprom3.txt</b>: Substantiv (weiblich)</li>
                <li><b>eeprom4.txt</b>: Substantiv (m&auml;nnlich)</li>
                <li><b>eeprom5.txt</b>: Substantiv (neutrum)</li>
            </ol>
            Jede dieser Dateien kann hier erstellt oder bearbeitet werden. <b>Leerzeichen</b> innerhalb eines 
            Wortes sind nicht erlaubt. <b>Umlaute</b> werden konvertiert, Leerzeilen entfernt, weniger als 
            zehn Zeichen werden mit Leerzeichen aufgef&uuml;llt.<br />
            <br />            
        </div>
        <div class="rechts-container">
            <div class="rechts">
                <button class="button load-button" onclick="loadFileForContainer(0)">Datei laden</button>
                <h3 id="opened1">Datei 1</h3>
                <div class="word-counter">Wörter: <b id="words1">0</b></div>
                <div class="container" id="container1"></div>
            </div>
            <div class="rechts">
                <button class="button load-button" onclick="loadFileForContainer(1)">Datei laden</button>
                <h3 id="opened2">Datei 2</h3>
                <div class="word-counter">Wörter: <b id="words2">0</b></div>
                <div class="container" id="container2"></div>
            </div>
            <div class="rechts">
                <button class="button load-button" onclick="loadFileForContainer(2)">Datei laden</button>
                <h3 id="opened3">Datei 3</h3>
                <div class="word-counter">Wörter: <b id="words3">0</b></div>
                <div class="container" id="container3"></div>
            </div>
            <div class="rechts">
                <button class="button load-button" onclick="loadFileForContainer(3)">Datei laden</button>
                <h3 id="opened4">Datei 4</h3>
                <div class="word-counter">Wörter: <b id="words4">0</b></div>
                <div class="container" id="container4"></div>
            </div>
            <div class="rechts">
                <button class="button load-button" onclick="loadFileForContainer(4)">Datei laden</button>
                <h3 id="opened5">Datei 5</h3>
                <div class="word-counter">Wörter: <b id="words5">0</b></div>
                <div class="container" id="container5"></div>
            </div>
        </div>
    </div>
    <div class="unten">
        <button class="button" onclick="addTextField('')">Textfeld hinzufügen</button>
        <select class="button" id="filename" title="Dateiname auswählen">
            <option value="eeprom1.txt">eeprom1.txt</option>
            <option value="eeprom2.txt">eeprom2.txt</option>
            <option value="eeprom3.txt">eeprom3.txt</option>
            <option value="eeprom4.txt">eeprom4.txt</option>
            <option value="eeprom5.txt">eeprom5.txt</option>
        </select>
        <button class="button" onclick="saveTextFields()">Speichern</button>
        Gesamt: <b id="words">0</b>
    </div>
</body>
</html>